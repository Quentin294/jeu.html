<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Menu Succès Relié au Jeu</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: linear-gradient(135deg, #222 60%, #3a6ee8 100%);
      color: #fff;
      min-height: 100vh;
      overflow: hidden;
    }
    .menu-bar {
      position: absolute;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 40px;
      z-index: 2;
    }
    .menu-btn {
      background: rgba(30,30,30,0.8);
      border: none;
      color: #fff;
      padding: 14px 28px;
      border-radius: 12px;
      font-size: 18px;
      cursor: pointer;
      transition: background 0.2s;
    }
    .menu-btn.active, .menu-btn:hover {
      background: #3a6ee8;
    }
    .left-panel {
      position: absolute;
      left: 30px;
      top: 120px;
      display: flex;
      flex-direction: column;
      gap: 20px;
      z-index: 2;
    }
    .left-item {
      background: rgba(40,40,40,0.85);
      border-radius: 10px;
      padding: 10px 20px;
      font-size: 16px;
      min-width: 120px;
      text-align: center;
    }
    .main-content {
      position: absolute;
      top: 100px;
      left: 50%;
      transform: translateX(-50%);
      width: 900px;
      min-height: 540px;
      background: rgba(35,43,59,0.98);
      border-radius: 30px;
      box-shadow: 0 8px 32px #0008;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      z-index: 1;
    }
    .tab-content { display: none; width: 100%; height: 100%; }
    .tab-content.active { display: block; }
    .center-skin {
      display: flex; flex-direction: column; align-items: center; width: 100%;
    }
    .skin-img {
      width: 320px; height: 400px;
      background: #444;
      border-radius: 30px;
      margin-bottom: 20px;
      box-shadow: 0 8px 32px #0008;
      background-image: url('https://static.wikia.nocookie.net/fortnite_gamepedia/images/3/3e/Outfit_Default_-_Style_1.png');
      background-size: cover;
      background-position: center;
      cursor: pointer;
    }
    .skin-name {
      font-size: 24px;
      font-weight: bold;
      letter-spacing: 2px;
      text-shadow: 0 2px 8px #000a;
    }
    .start-panel {
      position: absolute;
      bottom: 40px;
      right: 40px;
      z-index: 2;
    }
    .start-btn {
      background: #3a6ee8;
      color: #fff;
      border: none;
      border-radius: 18px;
      font-size: 24px;
      padding: 22px 48px;
      font-weight: bold;
      box-shadow: 0 4px 16px #0006;
      cursor: pointer;
      transition: background 0.2s;
    }
    .start-btn:hover {
      background: #254a9c;
    }
    .modal-bg {
      display: none;
      position: fixed;
      z-index: 100;
      left: 0; top: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.7);
      align-items: center;
      justify-content: center;
    }
    .modal-bg.active { display: flex; }
    .modal {
      background: #232b3b;
      border-radius: 24px;
      box-shadow: 0 8px 32px #000b;
      padding: 40px 32px 32px 32px;
      min-width: 320px;
      text-align: center;
      position: relative;
      animation: popin 0.2s;
    }
    @keyframes popin { from { transform: scale(0.7);} to { transform: scale(1);} }
    .modal-title {
      font-size: 28px;
      font-weight: bold;
      margin-bottom: 28px;
      letter-spacing: 1px;
    }
    .mode-btn {
      display: block;
      width: 100%;
      margin: 16px 0;
      padding: 18px 0;
      font-size: 22px;
      font-weight: bold;
      border: none;
      border-radius: 12px;
      background: #3a6ee8;
      color: #fff;
      cursor: pointer;
      transition: background 0.15s;
    }
    .mode-btn:hover { background: #254a9c; }
    .close-modal {
      position: absolute;
      top: 12px;
      right: 18px;
      background: none;
      border: none;
      color: #fff;
      font-size: 28px;
      cursor: pointer;
      opacity: 0.7;
      transition: opacity 0.15s;
    }
    .close-modal:hover { opacity: 1; }
    @media (max-width: 1000px) {
      .main-content { width: 98vw; min-height: 60vw; }
      .center-skin .skin-img { width: 180px; height: 220px;}
      .start-btn { font-size: 18px; padding: 12px 28px;}
      .modal { min-width: 200px; padding: 20px 8px 16px 8px;}
      .modal-title { font-size: 20px;}
      .mode-btn { font-size: 16px; padding: 10px 0;}
    }
    /* Mode Classique (mini-jeu) */
    #classicGameArea {
      position: relative;
      width: 900px;
      height: 540px;
      background: #232b3b;
      border-radius: 20px;
      box-shadow: 0 8px 32px #000a;
      overflow: hidden;
      margin: 0 auto;
    }
    #classicGameArea .player, #classicGameArea .enemy, #classicGameArea .coin, #classicGameArea .xp-bubble {
      position: absolute; border-radius: 50%;
      transition: box-shadow 0.1s;
    }
    #classicGameArea .player {
      width: 48px; height: 48px; background: #3a6ee8;
      border: 3px solid #fff; box-shadow: 0 0 12px #3a6ee8; z-index: 2;
    }
    #classicGameArea .enemy {
      width: 44px; height: 44px; background: #e83a3a;
      border: 3px solid #fff; box-shadow: 0 0 12px #e83a3a; z-index: 1;
      animation: enemyMove 1.2s infinite alternate;
    }
    @keyframes enemyMove { to { filter:brightness(1.2);} }
    #classicGameArea .coin {
      width: 32px; height: 32px; background: gold;
      border: 2px solid #fff; box-shadow: 0 0 8px #ffe066;
      background-image: radial-gradient(circle at 60% 40%,#fff7 30%,transparent 70%);
      z-index: 1;
    }
    #classicGameArea .xp-bubble {
      width: 24px; height: 24px; background: #43e86e;
      border: 2px solid #fff; box-shadow: 0 0 8px #43e86e;
      z-index: 1;
    }
    #classicGameArea #hud-left {
      position: absolute; top: 18px; left: 24px; color: #fff; z-index: 10;
      font-size: 20px; line-height: 1.6;
      text-shadow: 0 2px 8px #000a;
    }
    #classicGameArea #rank { font-size: 16px; margin-top: 8px; color: #ffe066;}
    #classicGameArea #xp-bar-bg {
      position: absolute; bottom: 28px; right: 32px; width: 260px; height: 22px;
      background: #1a2340; border-radius: 12px; border: 1.5px solid #fff5;
      box-shadow: 0 2px 8px #0006; z-index: 10;
    }
    #classicGameArea #xp-bar {
      height: 100%; border-radius: 12px; background: linear-gradient(90deg,#43e86e,#3a6ee8);
      width: 0%;
      transition: width 0.3s;
    }
    #classicGameArea #xp-label {
      position: absolute; bottom: 54px; right: 32px; color: #fff; font-size: 15px; z-index: 10;
      text-shadow: 0 2px 8px #000a;
    }
    #classicGameArea #achievements {
      position: absolute; top: 18px; right: 28px; z-index: 10; display: flex; align-items: center; gap: 10px;
    }
    #classicGameArea .trophy {
      width: 32px; height: 32px; border-radius: 50%; background: #ccc;
      display: flex; align-items: center; justify-content: center;
      font-size: 22px; color: #fff; box-shadow: 0 2px 8px #0006;
      border: 2px solid #fff8;
    }
    #classicGameArea .bronze { background: linear-gradient(135deg,#b87333,#f1c27d);}
    #classicGameArea .argent { background: linear-gradient(135deg,#bfc1c2,#f6f6f6);}
    #classicGameArea .or { background: linear-gradient(135deg,#ffde59,#ffe066);}
    #classicGameArea .modal-bg {
      display: none; position: absolute; left: 0;top: 0;right: 0;bottom: 0; background: rgba(0,0,0,0.7);
      z-index: 100; align-items: center; justify-content: center;
    }
    #classicGameArea .modal-bg.active { display: flex;}
    #classicGameArea .modal {
      background: #232b3b; border-radius: 22px; box-shadow: 0 8px 32px #000b;
      padding: 38px 28px 30px 28px; min-width: 320px; text-align: center; position: relative;
      animation: popin 0.2s;
    }
    #classicGameArea .modal-title { font-size: 28px; font-weight: bold; margin-bottom: 28px; letter-spacing: 1px;}
    #classicGameArea .modal-btn {
      display: block; width: 100%; margin: 16px 0; padding: 16px 0;
      font-size: 20px; font-weight: bold; border: none; border-radius: 10px;
      background: #3a6ee8; color: #fff; cursor: pointer; transition: background 0.15s;
    }
    #classicGameArea .modal-btn:hover { background: #254a9c;}
    #classicGameArea .modal-btn.quit { background: #e83a3a;}
    #classicGameArea .modal-btn.quit:hover { background: #a81a1a;}
    #classicGameArea .modal-btn.gold { background: #ffe066; color: #232b3b;}
    /* Succès */
    .achievements-list {
      margin: 40px auto 0 auto;
      max-width: 700px;
    }
    .achievement-row {
      display: flex;
      align-items: center;
      gap: 18px;
      padding: 18px 0;
      border-bottom: 1px solid #ffffff18;
    }
    .achievement-row:last-child { border-bottom: none; }
    .achievement-icon {
      width: 48px; height: 48px; border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      font-size: 28px; color: #fff;
      background: #3a6ee8;
      box-shadow: 0 2px 8px #0006;
      flex-shrink: 0;
      transition: filter 0.2s;
    }
    .achievement-row.locked .achievement-icon {
      background: #888;
      filter: grayscale(1) brightness(0.6);
    }
    .achievement-row.locked .achievement-title,
    .achievement-row.locked .achievement-desc {
      color: #aaa;
      filter: grayscale(1) brightness(0.7);
    }
    .achievement-info {
      display: flex;
      flex-direction: column;
    }
    .achievement-title {
      font-size: 20px; font-weight: bold; margin-bottom: 4px;
    }
    .achievement-desc {
      font-size: 15px; color: #fff9;
    }
    .progress-bar-bg {
      width: 90%; height: 26px; margin: 28px auto 0 auto;
      background: #1a2340; border-radius: 14px; border: 1.5px solid #fff5;
      box-shadow: 0 2px 8px #0006;
      position: relative;
      overflow: hidden;
    }
    .progress-bar {
      height: 100%; border-radius: 14px; background: linear-gradient(90deg,#43e86e,#3a6ee8);
      width: 0%;
      transition: width 0.5s;
    }
    .progress-label {
      position: absolute; left: 50%; top: 50%; transform: translate(-50%,-50%);
      color: #fff; font-size: 16px; font-weight: bold; text-shadow: 0 2px 8px #000a;
      z-index: 2;
    }
    /* Notification Succès */
    #achievement-toast {
      position: fixed;
      left: 50%; top: 60px;
      transform: translateX(-50%);
      background: #232b3b;
      color: #fff;
      padding: 18px 38px;
      border-radius: 18px;
      box-shadow: 0 4px 16px #000a;
      font-size: 20px;
      font-weight: bold;
      display: none;
      z-index: 200;
      border: 2px solid #43e86e;
      animation: popin 0.2s;
    }
  </style>
</head>
<body>
  <!-- Menu du haut -->
  <div class="menu-bar" id="mainMenuBar">
    <button class="menu-btn active" data-tab="commencer">Commencer</button>
    <button class="menu-btn" data-tab="succes">Succès</button>
    <button class="menu-btn" data-tab="roue">Roue</button>
    <button class="menu-btn" data-tab="tenues">Tenues</button>
    <button class="menu-btn" data-tab="passe">Passe de combat</button>
    <button class="menu-btn" data-tab="boutique">Boutique</button>
  </div>
  <!-- Panneau gauche -->
  <div class="left-panel" id="mainLeftPanel">
    <div class="left-item">💎 Diamants : <span id="diamonds">1500</span></div>
    <div class="left-item">📜 Quêtes</div>
    <div class="left-item">📅 Calendrier</div>
    <div class="left-item">🏆 Classement</div>
  </div>
  <!-- Contenu principal -->
  <div class="main-content" id="mainContent">
    <!-- Onglet Commencer -->
    <div class="tab-content active" id="tab-commencer">
      <div class="center-skin" id="skinPanel">
        <div class="skin-img" id="skinImg"></div>
        <div class="skin-name" id="skinName">Skin Actuel</div>
      </div>
      <div class="start-panel" id="startPanel">
        <button class="start-btn" id="openModalBtn">COMMENCER</button>
      </div>
      <!-- Modal Choix du mode -->
      <div class="modal-bg" id="modalBg">
        <div class="modal">
          <button class="close-modal" id="closeModalBtn" title="Fermer">&times;</button>
          <div class="modal-title">Choisis ton mode</div>
          <button class="mode-btn" id="classicBtn">Classique</button>
          <button class="mode-btn" onclick="alert('Mode Chrono à venir !')">Chrono</button>
          <button class="mode-btn" onclick="alert('Mode Infini à venir !')">Infini</button>
        </div>
      </div>
      <!-- Jeu classique (masqué par défaut) -->
      <div id="classicGameArea" style="display:none;"></div>
    </div>
    <!-- Onglet Succès -->
    <div class="tab-content" id="tab-succes">
      <div style="width:100%;text-align:center;padding:30px 0 0 0;">
        <h2>Succès</h2>
        <div class="progress-bar-bg">
          <div class="progress-bar" id="achvProgressBar"></div>
          <div class="progress-label" id="achvProgressLabel"></div>
        </div>
      </div>
      <div class="achievements-list" id="achievementsList"></div>
    </div>
    <!-- Onglet Roue -->
    <div class="tab-content" id="tab-roue">
      <div style="width:100%;text-align:center;padding:60px 0;">
        <h2>Roue</h2>
        <p>La roue des récompenses arrive bientôt !</p>
      </div>
    </div>
    <!-- Onglet Tenues -->
    <div class="tab-content" id="tab-tenues">
      <div style="width:100%;text-align:center;padding:60px 0;">
        <h2>Tenues</h2>
        <p>Choisis ton skin préféré ici !</p>
      </div>
    </div>
    <!-- Onglet Passe de combat -->
    <div class="tab-content" id="tab-passe">
      <div style="width:100%;text-align:center;padding:60px 0;">
        <h2>Passe de combat</h2>
        <p>Débloque des récompenses exclusives !</p>
      </div>
    </div>
    <!-- Onglet Boutique -->
    <div class="tab-content" id="tab-boutique">
      <div style="width:100%;text-align:center;padding:60px 0;">
        <h2>Boutique</h2>
        <p>Achetez des objets, skins et plus encore !</p>
      </div>
    </div>
  </div>
  <!-- Notification Succès -->
  <div id="achievement-toast"></div>
  <script>
    // --- Succès système ---
    const ACHIEVEMENTS = [
      { id: "first_coin", icon: "🪙", title: "Première pièce !", desc: "Ramasse ta première pièce." },
      { id: "ten_coins", icon: "💰", title: "Collectionneur", desc: "Ramasse 10 pièces en une partie." },
      { id: "hundred_xp", icon: "⚡", title: "XP 100", desc: "Atteins 100 XP en une partie." },
      { id: "survivor", icon: "🛡️", title: "Survivant", desc: "Atteins 200 de score sans mourir." },
      { id: "master_collector", icon: "👑", title: "Maître des pièces", desc: "Ramasse 30 pièces en une partie." }
    ];
    let achievementsState = {}; // {id: true/false}
    function resetAchievements() {
      achievementsState = {};
      for(const achv of ACHIEVEMENTS) achievementsState[achv.id] = false;
    }
    function getAchievementsCount() {
      return Object.values(achievementsState).filter(v=>v).length;
    }
    function renderAchievements() {
      const list = document.getElementById('achievementsList');
      list.innerHTML = '';
      for(const achv of ACHIEVEMENTS) {
        const unlocked = achievementsState[achv.id];
        list.innerHTML += `
          <div class="achievement-row${unlocked ? '' : ' locked'}">
            <div class="achievement-icon">${achv.icon}</div>
            <div class="achievement-info">
              <span class="achievement-title">${achv.title}</span>
              <span class="achievement-desc">${achv.desc}</span>
            </div>
          </div>
        `;
      }
      // Barre de progression
      const total = ACHIEVEMENTS.length, unlocked = getAchievementsCount();
      const percent = Math.round(100*unlocked/total);
      document.getElementById('achvProgressBar').style.width = percent + "%";
      document.getElementById('achvProgressLabel').textContent = `${unlocked} / ${total} succès (${percent}%)`;
    }
    // Toast notification succès
    function showAchievementToast(achv) {
      const toast = document.getElementById('achievement-toast');
      toast.innerHTML = `<span style="font-size:28px;margin-right:10px;">${achv.icon}</span> Succès débloqué : <b>${achv.title}</b>`;
      toast.style.display = "block";
      setTimeout(()=>{ toast.style.display = "none"; }, 2500);
    }
    // --- Navigation entre onglets ---
    const tabs = document.querySelectorAll('.menu-btn');
    const tabContents = document.querySelectorAll('.tab-content');
    tabs.forEach(btn => {
      btn.onclick = () => {
        tabs.forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        tabContents.forEach(tc=>tc.classList.remove('active'));
        document.getElementById('tab-'+btn.dataset.tab).classList.add('active');
        if(btn.dataset.tab==="succes") renderAchievements();
      }
    });
    // --- Skin demo ---
    const skins = [
      {name: "Agent Élite", img: "https://static.wikia.nocookie.net/fortnite_gamepedia/images/3/3e/Outfit_Default_-_Style_1.png"},
      {name: "Chevalier Noir", img: "https://static.wikia.nocookie.net/fortnite_gamepedia/images/4/48/Outfit_Black_Knight.png"},
    ];
    let currentSkin = 0;
    document.getElementById('skinImg').onclick = () => {
      currentSkin = (currentSkin + 1) % skins.length;
      document.getElementById('skinImg').style.backgroundImage = `url('${skins[currentSkin].img}')`;
      document.getElementById('skinName').textContent = skins[currentSkin].name;
    };
    // --- Modal Choix du mode ---
    const modalBg = document.getElementById('modalBg');
    document.getElementById('openModalBtn').onclick = () => {
      modalBg.classList.add('active');
    };
    document.getElementById('closeModalBtn').onclick = () => {
      modalBg.classList.remove('active');
    };
    modalBg.onclick = (e) => {
      if (e.target === modalBg) modalBg.classList.remove('active');
    };
    document.getElementById('classicBtn').onclick = launchClassic;
    let classicGameInstance = null;
    function launchClassic() {
      modalBg.classList.remove('active');
      document.getElementById('mainMenuBar').style.display = 'none';
      document.getElementById('mainLeftPanel').style.display = 'none';
      document.getElementById('mainContent').style.background = 'transparent';
      tabContents.forEach(tc=>tc.classList.remove('active'));
      document.getElementById('tab-commencer').classList.add('active');
      document.getElementById('skinPanel').style.display = 'none';
      document.getElementById('startPanel').style.display = 'none';
      document.getElementById('classicGameArea').style.display = 'block';
      resetAchievements(); // Reset succès à chaque partie
      if (classicGameInstance && classicGameInstance.destroy) classicGameInstance.destroy();
      classicGameInstance = startClassicGame();
    }
    function showMainMenu() {
      document.getElementById('mainMenuBar').style.display = '';
      document.getElementById('mainLeftPanel').style.display = '';
      document.getElementById('mainContent').style.background = '';
      tabContents.forEach(tc=>tc.classList.remove('active'));
      document.getElementById('tab-commencer').classList.add('active');
      document.getElementById('skinPanel').style.display = '';
      document.getElementById('startPanel').style.display = '';
      document.getElementById('classicGameArea').style.display = 'none';
      if (classicGameInstance && classicGameInstance.destroy) classicGameInstance.destroy();
      classicGameInstance = null;
    }
    // --- Mode Classique (mini-jeu) ---
    function startClassicGame() {
      const area = document.getElementById('classicGameArea');
      area.innerHTML = `
      <div id="hud-left">
        <div>Score : <span id="score">0</span></div>
        <div>🪙 Pièces : <span id="coins">0</span></div>
        <div id="rank">Rang : Débutant</div>
      </div>
      <div id="achievements">
        <div class="trophy bronze" id="trophy" title="Difficulté : Bronze">🏆</div>
        <span id="achv-label">Succès</span>
      </div>
      <div id="xp-bar-bg">
        <div id="xp-bar"></div>
      </div>
      <div id="xp-label">XP : <span id="xp">0</span> / <span id="xp-max">100</span></div>
      <div class="modal-bg" id="pauseModal">
        <div class="modal">
          <div class="modal-title">Pause</div>
          <button class="modal-btn" id="resumeBtn">Reprendre</button>
          <button class="modal-btn" id="restartBtn">Recommencer</button>
          <button class="modal-btn quit" id="quitBtn">Quitter</button>
        </div>
      </div>
      <div class="modal-bg" id="gameOverModal">
        <div class="modal">
          <div class="modal-title">GAME OVER</div>
          <button class="modal-btn gold" id="restartBtnGO">Recommencer</button>
          <button class="modal-btn quit" id="quitBtnGO">Quitter</button>
        </div>
      </div>
      <div class="player" id="player"></div>
      <div class="enemy" id="enemy1"></div>
      <div class="enemy" id="enemy2"></div>
      <div class="coin" id="coin"></div>
      <div class="xp-bubble" id="xpBubble"></div>
      `;
      let width = area.clientWidth, height = area.clientHeight;
      let px = width/2-24, py = height/2-24, ps = 6;
      let ex = [100, width-100], ey = [100, height-100], evx = [3, -2.5], evy = [2.5, 3];
      let coinPos = [200, 200], xpPos = [400, 400];
      let score = 0, coins = 0, xp = 0, xpMax = 100;
      let paused = false, gameOver = false;
      let difficulty = "bronze";
      let keys = {};
      let running = true;
      let frameId = null;
      function getRank(n) {
        if (n >= 30) return "Maître";
        if (n >= 20) return "Expert";
        if (n >= 10) return "Pro";
        if (n >= 5) return "Avancé";
        return "Débutant";
      }
      function setDifficulty(diff) {
        difficulty = diff;
        const trophy = document.getElementById('trophy');
        const achvLabel = document.getElementById('achv-label');
        if(diff==="bronze") { trophy.className="trophy bronze"; trophy.title="Difficulté : Bronze"; achvLabel.textContent="Succès"; }
        if(diff==="argent") { trophy.className="trophy argent"; trophy.title="Difficulté : Argent"; achvLabel.textContent="Succès"; }
        if(diff==="or") { trophy.className="trophy or"; trophy.title="Difficulté : Or"; achvLabel.textContent="Succès"; }
      }
      setDifficulty("bronze");
      function placeRandom(el, margin=40) {
        let x = Math.random()*(width-margin*2)+margin;
        let y = Math.random()*(height-margin*2)+margin;
        el.style.left = x+"px";
        el.style.top = y+"px";
        return [x,y];
      }
      function updateEntities() {
        document.getElementById('player').style.left = px+"px";
        document.getElementById('player').style.top = py+"px";
        document.getElementById('enemy1').style.left = ex[0]+"px";
        document.getElementById('enemy1').style.top = ey[0]+"px";
        document.getElementById('enemy2').style.left = ex[1]+"px";
        document.getElementById('enemy2').style.top = ey[1]+"px";
        document.getElementById('coin').style.left = coinPos[0]+"px";
        document.getElementById('coin').style.top = coinPos[1]+"px";
        document.getElementById('xpBubble').style.left = xpPos[0]+"px";
        document.getElementById('xpBubble').style.top = xpPos[1]+"px";
      }
      function updateHUD() {
        document.getElementById('score').textContent = score;
        document.getElementById('coins').textContent = coins;
        document.getElementById('rank').textContent = "Rang : "+getRank(coins);
        document.getElementById('xp').textContent = xp;
        document.getElementById('xp-max').textContent = xpMax;
        document.getElementById('xp-bar').style.width = Math.min(100,100*xp/xpMax)+"%";
      }
      function unlockAchievement(id) {
        if (!achievementsState[id]) {
          achievementsState[id] = true;
          renderAchievements();
          const achv = ACHIEVEMENTS.find(a=>a.id===id);
          if(achv) showAchievementToast(achv);
        }
      }
      function checkAchievements() {
        if(coins >= 1) unlockAchievement("first_coin");
        if(coins >= 10) unlockAchievement("ten_coins");
        if(xp >= 100) unlockAchievement("hundred_xp");
        if(score >= 200) unlockAchievement("survivor");
        if(coins >= 30) unlockAchievement("master_collector");
      }
      function resetGame() {
        px = width/2-24; py = height/2-24;
        ex[0]=100; ey[0]=100; ex[1]=width-100; ey[1]=height-100;
        evx=[3, -2.5]; evy=[2.5, 3];
        score=0; coins=0; xp=0; xpMax=100;
        gameOver=false; paused=false;
        coinPos = placeRandom(document.getElementById('coin'));
        xpPos = placeRandom(document.getElementById('xpBubble'), 30);
        updateEntities(); updateHUD();
        document.getElementById('pauseModal').classList.remove('active');
        document.getElementById('gameOverModal').classList.remove('active');
        area.focus();
        resetAchievements();
        renderAchievements();
      }
      function pauseGame() { if(!gameOver){ paused=true; document.getElementById('pauseModal').classList.add('active');}}
      function resumeGame() { paused=false; document.getElementById('pauseModal').classList.remove('active'); area.focus();}
      function quitToMenu() {
        running = false;
        showMainMenu();
      }
      function restartGame() {
        running = false;
        setTimeout(() => {
          running = true;
          resetGame();
          frameId = requestAnimationFrame(gameLoop);
        }, 30);
      }
      function showGameOver() { gameOver=true; document.getElementById('gameOverModal').classList.add('active'); }
      function rectsCollide(ax,ay,aw,ah,bx,by,bw,bh) {
        return ax<bx+bw && ax+aw>bx && ay<by+bh && ay+ah>by;
      }
      function gameLoop() {
        if(!running) return;
        if(!paused && !gameOver) {
          if(keys["ArrowLeft"]||keys["KeyA"]) px=Math.max(0,px-ps);
          if(keys["ArrowRight"]||keys["KeyD"]) px=Math.min(width-48,px+ps);
          if(keys["ArrowUp"]||keys["KeyW"]) py=Math.max(0,py-ps);
          if(keys["ArrowDown"]||keys["KeyS"]) py=Math.min(height-48,py+ps);
          for(let i=0;i<2;i++) {
            ex[i]+=evx[i]; ey[i]+=evy[i];
            if(ex[i]<0||ex[i]>width-44) evx[i]*=-1;
            if(ey[i]<0||ey[i]>height-44) evy[i]*=-1;
          }
          for(let i=0;i<2;i++) {
            if(rectsCollide(px,py,48,48,ex[i],ey[i],44,44)) { showGameOver(); return; }
          }
          if(rectsCollide(px,py,48,48,coinPos[0],coinPos[1],32,32)) {
            coins++; score+=10;
            coinPos = placeRandom(document.getElementById('coin'));
            updateHUD();
            checkAchievements();
          }
          if(rectsCollide(px,py,48,48,xpPos[0],xpPos[1],24,24)) {
            xp+=20; score+=2;
            if(xp>=xpMax) { xp-=xpMax; xpMax+=50; score+=20; }
            xpPos = placeRandom(document.getElementById('xpBubble'), 30);
            updateHUD();
            checkAchievements();
          }
          checkAchievements();
          updateEntities();
        }
        frameId = requestAnimationFrame(gameLoop);
      }
      area.tabIndex = 1;
      area.focus();
      keys = {};
      function keydownHandler(e) {
        if(e.code==="Space") { if(!paused && !gameOver) pauseGame(); else if(paused) resumeGame(); }
        keys[e.code]=true;
      }
      function keyupHandler(e){ keys[e.code]=false; }
      area.addEventListener('keydown', keydownHandler);
      area.addEventListener('keyup', keyupHandler);
      document.getElementById('resumeBtn').onclick = resumeGame;
      document.getElementById('restartBtn').onclick = restartGame;
      document.getElementById('quitBtn').onclick = quitToMenu;
      document.getElementById('restartBtnGO').onclick = restartGame;
      document.getElementById('quitBtnGO').onclick = quitToMenu;
      resetGame();
      running = true;
      frameId = requestAnimationFrame(gameLoop);
      renderAchievements();
      return {
        destroy: function() {
          running = false;
          if (frameId) cancelAnimationFrame(frameId);
          area.removeEventListener('keydown', keydownHandler);
          area.removeEventListener('keyup', keyupHandler);
        }
      };
    }
    // Initialisation succès
    resetAchievements();
    renderAchievements();
  </script>
</body>
</html>
