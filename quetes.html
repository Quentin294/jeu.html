<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Qu√™tes du jour</title>
  <style>
    body {margin:0;font-family:Arial,sans-serif;background:#232b3b;color:#fff;}
    .container {max-width:600px;margin:40px auto 0 auto;background:#232b3bcc;border-radius:24px;box-shadow:0 8px 32px #000a;padding:40px 32px;}
    h1 {text-align:center;font-size:38px;margin-bottom:16px;}
    .chrono {text-align:center;font-size:22px;color:#ffe066;margin-bottom:32px;}
    .quest-list {margin:0 auto 24px auto;max-width:420px;}
    .quest-row {display:flex;align-items:center;justify-content:space-between;background:#232b3b;margin-bottom:18px;padding:14px 18px;border-radius:12px;box-shadow:0 2px 8px #0005;}
    .quest-label {font-size:18px;}
    .quest-xp {font-size:15px;color:#ffe066;}
    .quest-status {font-size:15px;font-weight:bold;}
    .quest-status.done {color:#43e86e;}
    .quest-status.inprogress {color:#ffe066;}
    .gift {text-align:center;margin:22px 0;font-size:20px;}
    .btn-menu {margin-top:28px;display:block;background:#3a6ee8;color:#fff;border:none;border-radius:12px;font-size:22px;padding:14px 36px;font-weight:bold;cursor:pointer;}
    .btn-menu:hover {background:#254a9c;}
  </style>
</head>
<body>
  <div class="container">
    <h1>Qu√™tes du jour</h1>
    <div class="chrono" id="questChrono"></div>
    <div class="quest-list" id="questList"></div>
    <div class="gift" id="questGift"></div>
    <button class="btn-menu" onclick="window.history.back()">&larr; Retour</button>
  </div>
  <script>
    const QUESTS = [
      { id: "collect_10_coins", label: "Ramasse 10 pi√®ces", xp: 50 },
      { id: "survive_2_min", label: "Survis 2 minutes", xp: 75 },
      { id: "get_200_score", label: "Atteins 200 de score", xp: 100 }
    ];
    const QUEST_RESET_HOURS = 24;
    function getQuestState() {
      let state = {};
      try { state = JSON.parse(localStorage.getItem("questState")||"{}"); } catch(e){}
      if(!state.resetAt || Date.now() > state.resetAt) {
        state = { resetAt: Date.now() + QUEST_RESET_HOURS*3600*1000 };
        for(const q of QUESTS) state[q.id] = false;
        state.gift = false;
        localStorage.setItem("questState", JSON.stringify(state));
      }
      for(const q of QUESTS) if(state[q.id]===undefined) state[q.id]=false;
      if(state.gift===undefined) state.gift=false;
      return state;
    }
    function saveQuestState(state) {
      localStorage.setItem("questState", JSON.stringify(state));
    }
    function renderQuests() {
      let state = getQuestState();
      const list = document.getElementById('questList');
      list.innerHTML = '';
      let allDone = true;
      for(const q of QUESTS) {
        const done = !!state[q.id];
        if(!done) allDone = false;
        list.innerHTML += `
          <div class="quest-row">
            <span class="quest-label">${q.label}</span>
            <span class="quest-xp">+${q.xp} XP</span>
            <span class="quest-status ${done ? 'done' : 'inprogress'}">${done ? 'Termin√©' : 'En cours'}</span>
          </div>
        `;
      }
      // Cadeau si toutes faites
      const gift = document.getElementById('questGift');
      if(allDone) {
        if(!state.gift) {
          gift.innerHTML = "<b>üéÅ Tu as gagn√© un cadeau du jour !</b>";
          state.gift = true;
          saveQuestState(state);
        } else {
          gift.innerHTML = "<b>üéÅ Cadeau du jour d√©j√† obtenu !</b>";
        }
      } else {
        gift.innerHTML = "";
      }
    }
    function updateChrono() {
      let state = getQuestState();
      let left = Math.max(0, state.resetAt - Date.now());
      let h = Math.floor(left/3600000), m = Math.floor((left%3600000)/60000), s = Math.floor((left%60000)/1000);
      document.getElementById('questChrono').textContent = `Temps restant : ${h}h ${m}m ${s}s`;
      if(left <= 0) { renderQuests(); }
      setTimeout(updateChrono, 1000);
    }
    renderQuests();
    updateChrono();
    window.addEventListener('storage', function(event) {
      if(event.key === "questState") renderQuests();
    });
  </script>
</body>
</html>
