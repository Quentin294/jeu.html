<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Qu√™tes Quotidiennes</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(to bottom right, #1f1c2c, #928dab);
      color: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 30px;
    }

    h1 {
      margin-bottom: 10px;
    }

    #timer {
      font-size: 20px;
      margin-bottom: 30px;
      background: rgba(0, 0, 0, 0.5);
      padding: 10px 20px;
      border-radius: 10px;
    }

    .quest {
      background-color: rgba(255, 255, 255, 0.1);
      border-radius: 15px;
      padding: 20px;
      margin: 15px;
      width: 80%;
      max-width: 500px;
      box-shadow: 0 0 10px #000;
    }

    .quest h3 {
      margin-top: 0;
    }

    .quest button {
      margin-top: 10px;
      padding: 10px 20px;
      background-color: #2ecc71;
      border: none;
      border-radius: 10px;
      color: white;
      cursor: pointer;
      font-weight: bold;
    }

    .quest button[disabled] {
      background-color: #555;
      cursor: default;
    }

    #rewardBox {
      margin-top: 30px;
      padding: 20px;
      background-color: #e67e22;
      color: white;
      font-size: 22px;
      border-radius: 12px;
      display: none;
      cursor: pointer;
    }

    #rewardBox.unlocked {
      display: block;
    }
  </style>
</head>
<body>

  <h1>Qu√™tes Quotidiennes</h1>
  <div id="timer">Renouvellement dans : --:--:--</div>

  <div id="quests"></div>

  <div id="rewardBox" onclick="claimFinalReward()">üéÅ R√©clamer le cadeau quotidien</div>

  <script>
    const QUESTS = [
      { text: "Collecte 10 pi√®ces", key: "collect_10_coins", goal: 10, xp: 50 },
      { text: "Tue 3 ennemis", key: "kill_3_enemies", goal: 3, xp: 50 },
      { text: "Collecte 5 bulles d'XP", key: "collect_5_xp", goal: 5, xp: 50 },
      { text: "Joue 2 parties", key: "play_2_games", goal: 2, xp: 50 },
      { text: "Saute 15 fois", key: "jump_15_times", goal: 15, xp: 50 },
      { text: "Gagne 100 points", key: "score_100", goal: 100, xp: 50 },
    ];

    const QUESTS_PER_DAY = 3;
    const REFRESH_INTERVAL = 24 * 60 * 60 * 1000; // 24h en ms

    function getTodayQuests() {
      let saved = JSON.parse(localStorage.getItem("dailyQuests")) || {};
      let now = Date.now();

      if (!saved.timestamp || now - saved.timestamp > REFRESH_INTERVAL) {
        const shuffled = QUESTS.sort(() => 0.5 - Math.random()).slice(0, QUESTS_PER_DAY);
        const quests = shuffled.map(q => ({
          ...q,
          progress: 0,
          done: false,
          claimed: false
        }));
        saved = { timestamp: now, quests: quests, rewardClaimed: false };
        localStorage.setItem("dailyQuests", JSON.stringify(saved));
      }

      return saved;
    }

    function saveTodayQuests(data) {
      localStorage.setItem("dailyQuests", JSON.stringify(data));
    }

    function formatTime(ms) {
      const s = Math.floor(ms / 1000);
      const h = String(Math.floor(s / 3600)).padStart(2, "0");
      const m = String(Math.floor((s % 3600) / 60)).padStart(2, "0");
      const sec = String(s % 60).padStart(2, "0");
      return `${h}:${m}:${sec}`;
    }

    function renderQuests() {
      const container = document.getElementById("quests");
      container.innerHTML = "";
      const data = getTodayQuests();

      data.quests.forEach((quest, index) => {
        const div = document.createElement("div");
        div.className = "quest";

        const progressText = quest.done ? "‚úÖ Termin√©" : `Progression : ${quest.progress}/${quest.goal}`;
        div.innerHTML = `
          <h3>${quest.text}</h3>
          <p>${progressText}</p>
        `;

        const button = document.createElement("button");
        button.textContent = quest.claimed ? "R√©compens√©" : "R√©clamer + " + quest.xp + " XP";
        button.disabled = !quest.done || quest.claimed;
        button.onclick = () => {
          quest.claimed = true;
          addXP(quest.xp);
          saveTodayQuests(data);
          renderQuests();
          checkFinalReward();
        };

        div.appendChild(button);
        container.appendChild(div);
      });
    }

    function updateTimer() {
      const data = getTodayQuests();
      const now = Date.now();
      const next = data.timestamp + REFRESH_INTERVAL;
      const diff = Math.max(0, next - now);
      document.getElementById("timer").textContent = "Renouvellement dans : " + formatTime(diff);

      if (diff === 0) {
        localStorage.removeItem("dailyQuests");
        location.reload();
      }
    }

    function checkFinalReward() {
      const data = getTodayQuests();
      const allClaimed = data.quests.every(q => q.claimed);
      if (allClaimed && !data.rewardClaimed) {
        document.getElementById("rewardBox").classList.add("unlocked");
      } else {
        document.getElementById("rewardBox").classList.remove("unlocked");
      }
    }

    function claimFinalReward() {
      const data = getTodayQuests();
      if (data.rewardClaimed) return;
      data.rewardClaimed = true;

      // üéÅ Exemple : offrir un diamant
      const diamonds = parseInt(localStorage.getItem("diamonds") || "0");
      localStorage.setItem("diamonds", diamonds + 1);

      alert("Bravo ! Tu as gagn√© 1 üíé !");
      saveTodayQuests(data);
      document.getElementById("rewardBox").classList.remove("unlocked");
    }

    function addXP(amount) {
      const xp = parseInt(localStorage.getItem("xp") || "0");
      localStorage.setItem("xp", xp + amount);
    }

    function simulateProgressForTest() {
      const data = getTodayQuests();
      data.quests.forEach(q => {
        q.progress = q.goal;
        q.done = true;
      });
      saveTodayQuests(data);
      renderQuests();
      checkFinalReward();
    }

    // Appels initiaux
    renderQuests();
    checkFinalReward();
    setInterval(updateTimer, 1000);

    // Pour test rapide :
    // simulateProgressForTest(); // d√©commente pour simuler les 3 qu√™tes accomplies
  </script>

</body>
</html>
