<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Roue des couleurs</title>
  <style>
    body {margin:0;font-family:Arial,sans-serif;background:#232b3b;color:#fff;}
    .container {max-width:600px;margin:40px auto 0 auto;background:#232b3bcc;border-radius:24px;box-shadow:0 8px 32px #000a;padding:40px 32px;}
    h1 {text-align:center;font-size:38px;margin-bottom:16px;}
    .chrono {text-align:center;font-size:22px;color:#ffe066;margin-bottom:32px;}
    .wheel-area {display:flex;flex-direction:column;align-items:center;}
    #wheelCanvas {background:#232b3b;border-radius:50%;box-shadow:0 4px 24px #0008;}
    .wheel-btn {margin-top:30px;padding:18px 42px;font-size:22px;background:#3a6ee8;color:#fff;border:none;border-radius:14px;cursor:pointer;font-weight:bold;box-shadow:0 2px 8px #0006;transition:background 0.2s;}
    .wheel-btn[disabled] {background:#888;cursor:not-allowed;}
    .wheel-result {margin-top:30px;font-size:20px;text-align:center;min-height:40px;}
    .wheel-won-colors {margin-top:20px;font-size:16px;text-align:center;max-width:90%;word-wrap:break-word;}
    .color-badge {display:inline-block;width:30px;height:30px;border-radius:50%;margin:0 6px 4px 0;border:2px solid #fff;vertical-align:middle;}
    .btn-menu {margin-top:28px;display:block;background:#3a6ee8;color:#fff;border:none;border-radius:12px;font-size:22px;padding:14px 36px;font-weight:bold;cursor:pointer;}
    .btn-menu:hover {background:#254a9c;}
    #wheel-toast {position:fixed;left:50%;top:80px;transform:translateX(-50%);background:#232b3b;color:#fff;padding:18px 38px;border-radius:18px;box-shadow:0 4px 16px #000a;font-size:20px;font-weight:bold;display:none;z-index:200;border:2px solid #43e86e;animation:popin 0.2s;}
    @keyframes popin {from{transform:scale(0.7);}to{transform:scale(1);}}
  </style>
</head>
<body>
  <div class="container">
    <h1>üé® Roue des couleurs</h1>
    <div class="chrono" id="wheelChrono"></div>
    <div class="wheel-area">
      <canvas id="wheelCanvas" width="350" height="350"></canvas>
      <button class="wheel-btn" id="spinBtn">Tourner la roue</button>
      <div class="wheel-result" id="wheelResult"></div>
      <div class="wheel-won-colors" id="wheelWonColors"></div>
    </div>
    <button class="btn-menu" onclick="window.history.back()">&larr; Retour au menu</button>
  </div>
  <div id="wheel-toast"></div>
  <script>
    // Palette de couleurs (tu peux personnaliser)
    const wheelColors = [
      {name:"Rouge", color:"#FF3B30"},
      {name:"Orange", color:"#FF9500"},
      {name:"Jaune", color:"#FFCC00"},
      {name:"Vert", color:"#34C759"},
      {name:"Bleu", color:"#007AFF"},
      {name:"Violet", color:"#AF52DE"},
      {name:"Rose", color:"#FF2D55"},
      {name:"Turquoise", color:"#5AC8FA"}
    ];

    // --- Gestion du cooldown (1h entre chaque spin) ---
    function getNextSpinTime() {
      return parseInt(localStorage.getItem("wheelNextSpinColor")||"0");
    }
    function setNextSpinTime(ts) {
      localStorage.setItem("wheelNextSpinColor",ts+"");
    }

    // --- Gestion des couleurs gagn√©es ---
    function getWonColors() {
      try {
        return JSON.parse(localStorage.getItem("wonColors")||"[]");
      } catch(e) { return []; }
    }
    function saveWonColors(arr) {
      localStorage.setItem("wonColors", JSON.stringify(arr));
    }
    function updateWheelWonColors() {
      const el = document.getElementById('wheelWonColors');
      const colors = getWonColors();
      if(colors.length===0) {
        el.innerHTML = "Aucune couleur gagn√©e pour l‚Äôinstant.";
      } else {
        el.innerHTML = "Couleurs gagn√©es :<br>" + colors.map(c=>{
          const obj = wheelColors.find(wc=>wc.name===c);
          return `<span class="color-badge" title="${c}" style="background:${obj ? obj.color : '#fff'}"></span>`;
        }).join("") + "<br>" + colors.join(", ");
      }
    }

    // --- Chrono avant prochain spin ---
    function updateWheelCooldown() {
      const btn = document.getElementById('spinBtn');
      const now = Date.now();
      const next = getNextSpinTime();
      const chrono = document.getElementById('wheelChrono');
      if(now < next) {
        btn.disabled = true;
        let sec = Math.ceil((next-now)/1000);
        let min = Math.floor(sec/60);
        sec = sec%60;
        btn.textContent = `Reviens dans ${min}m ${sec}s`;
        chrono.textContent = `Prochain tirage disponible dans ${min}m ${sec}s`;
        setTimeout(updateWheelCooldown, 1000);
      } else {
        btn.disabled = false;
        btn.textContent = "Tourner la roue";
        chrono.textContent = "Tourne la roue pour gagner une nouvelle couleur !";
      }
    }

    // --- Affichage de la roue ---
    function drawWheel(angle=0) {
      const canvas = document.getElementById('wheelCanvas');
      if(!canvas) return;
      const ctx = canvas.getContext('2d');
      const n = wheelColors.length;
      const r = 170;
      ctx.clearRect(0,0,canvas.width,canvas.height);
      for(let i=0;i<n;i++) {
        const start = angle + i*2*Math.PI/n;
        const end = angle + (i+1)*2*Math.PI/n;
        ctx.beginPath();
        ctx.moveTo(175,175);
        ctx.arc(175,175,r,start,end);
        ctx.closePath();
        ctx.fillStyle = wheelColors[i].color;
        ctx.fill();
        // Label couleur
        ctx.save();
        ctx.translate(175,175);
        ctx.rotate((start+end)/2);
        ctx.textAlign = "right";
        ctx.font = "bold 18px Arial";
        ctx.fillStyle = "#fff";
        ctx.strokeStyle = "#232b3b";
        ctx.lineWidth = 6;
        ctx.strokeText(wheelColors[i].name, r-20,8);
        ctx.fillText(wheelColors[i].name, r-20,8);
        ctx.restore();
      }
      // Fl√®che
      ctx.beginPath();
      ctx.moveTo(175,10); ctx.lineTo(165,40); ctx.lineTo(185,40); ctx.closePath();
      ctx.fillStyle = "#ffe066"; ctx.fill();
    }

    // --- Spin de la roue ---
    function showWheelToast(msg) {
      const toast = document.getElementById('wheel-toast');
      toast.textContent = msg;
      toast.style.display = "block";
      setTimeout(()=>{ toast.style.display = "none"; }, 2500);
    }
    function spinWheel() {
      const btn = document.getElementById('spinBtn');
      if(btn.disabled) return;
      btn.disabled = true;
      btn.textContent = "Tirage...";
      let angle = 0;
      let t = 0, duration = 3500 + Math.random()*600;
      let targetIndex = Math.floor(Math.random()*wheelColors.length);
      let targetAngle = 2*Math.PI*3 + (2*Math.PI/wheelColors.length)*(wheelColors.length-targetIndex-0.5);
      function animate() {
        t += 16;
        let progress = Math.min(1, t/duration);
        let ease = 1-Math.pow(1-progress,3);
        angle = ease*targetAngle;
        drawWheel(angle);
        if(progress<1) requestAnimationFrame(animate);
        else {
          const colorObj = wheelColors[targetIndex];
          document.getElementById('wheelResult').innerHTML = `<b>Bravo !</b> Tu as gagn√© la couleur <span style="color:${colorObj.color};font-weight:bold">${colorObj.name}</span> !`;
          let won = getWonColors();
          if(!won.includes(colorObj.name)) {
            won.push(colorObj.name);
            saveWonColors(won);
            showWheelToast(`Nouvelle couleur gagn√©e : ${colorObj.name} !`);
          } else {
            showWheelToast(`Tu as d√©j√† cette couleur : ${colorObj.name}`);
          }
          updateWheelWonColors();
          setNextSpinTime(Date.now() + 3600*1000);
          updateWheelCooldown();
        }
      }
      animate();
    }

    // --- Initialisation ---
    document.getElementById('spinBtn').onclick = spinWheel;
    drawWheel();
    updateWheelCooldown();
    updateWheelWonColors();
    setInterval(updateWheelCooldown, 1000);

    // --- Synchronisation multi-onglets ---
    window.addEventListener('storage', function(event) {
      if(event.key === "wonColors") {
        updateWheelWonColors();
      }
    });
  </script>
</body>
</html>
